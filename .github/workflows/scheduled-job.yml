name: Scheduled Job at 2:00 UTC

on:
  schedule:
    # This runs at 2:00 UTC every day
    # Format: minute hour day_of_month month day_of_week
    - cron: '0 2 * * *'
  
  # Allow manual trigger with mode selection
  workflow_dispatch:
    inputs:
      mode:
        description: 'Tryb analizy (Analysis mode)'
        required: true
        default: 'both'
        type: choice
        options:
          - both           # Gospodarze + Go≈õcie (2 emaile)
          - home-only      # Tylko gospodarze
          - away-only      # Tylko go≈õcie
          - combined       # Home+Away w jednym emailu

jobs:
  scheduled-task:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
      
      - name: "Run scheduled task"
        run: |
          echo "üöÄ Rozpoczynam scraping..."
          echo "üìÖ Data: $(date)"
          echo "üéØ Tryb: ${{ github.event.inputs.mode || 'both' }}"
          
          # Ustaw flagƒô na podstawie trybu
          MODE="${{ github.event.inputs.mode }}"
          FLAGS=""
          
          if [ "$MODE" = "home-only" ]; then
            FLAGS="--home-only"
            echo "üè† Tryb: TYLKO GOSPODARZE"
          elif [ "$MODE" = "away-only" ]; then
            FLAGS="--away-only"
            echo "üë• Tryb: TYLKO GO≈öCIE"
          elif [ "$MODE" = "combined" ]; then
            FLAGS="--combined-email"
            echo "üìß Tryb: JEDEN EMAIL (home+away)"
          else
            echo "üè†üë• Tryb: OBAJ (2 osobne emaile)"
          fi
          
          # Uruchom scraper
          python scrape_and_notify.py \
            --date $(date +%Y-%m-%d) \
            --sports volleyball basketball handball \
            --to ${{ secrets.EMAIL_TO }} \
            --from-email ${{ secrets.EMAIL_FROM }} \
            --password ${{ secrets.SMTP_PASSWORD }} \
            --provider gmail \
            --headless \
            $FLAGS
        env:
          SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
          EMAIL_TO: ${{ secrets.EMAIL_TO }}
          EMAIL_FROM: ${{ secrets.EMAIL_FROM }}
